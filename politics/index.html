<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é«˜è€ƒæ”¿æ²»ç‰¹è®­ï¼ˆè‡ªåŠ¨æ±‡æŠ¥ç‰ˆï¼‰</title>
    <!-- å¼•å…¥ EmailJS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --success: #16a34a;
            --success-bg: #dcfce7;
            --danger: #dc2626;
            --danger-bg: #fee2e2;
            --warning: #ca8a04;
            --warning-bg: #fef9c3;
            --purple: #7e22ce;
            --purple-bg: #f3e8ff;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --text-main: #111827;
            --text-sub: #6b7280;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--gray-100);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        /* é¡¶éƒ¨å¯¼èˆª */
        header {
            background-color: var(--gray-800);
            color: white;
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .progress-container {
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-bar-bg {
            width: 60px;
            height: 6px;
            background-color: #4b5563;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background-color: #facc15;
            width: 0%;
            transition: width 0.3s ease;
        }

        /* ä¸»å®¹å™¨ */
        .container {
            padding: 1rem;
            max-width: 800px;
            margin: 0 auto;
            padding-bottom: 80px;
        }

        /* å¡ç‰‡æ ·å¼ */
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
            overflow: hidden;
            border: 1px solid var(--gray-200);
        }

        .card-header {
            background-color: var(--gray-50);
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .tag {
            background-color: #dbeafe;
            color: #1e40af;
            font-size: 0.75rem;
            font-weight: bold;
            padding: 2px 8px;
            border-radius: 4px;
        }
        
        .tag-pol {
            background-color: var(--purple-bg);
            color: var(--purple);
        }

        .score-tag {
            font-family: monospace;
            color: var(--text-sub);
            font-size: 0.85rem;
        }

        .card-body {
            padding: 1.25rem;
        }

        .q-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-top: 0;
            margin-bottom: 1rem;
            line-height: 1.4;
        }

        .q-content {
            background-color: var(--gray-50);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid var(--gray-200);
            margin-bottom: 1rem;
        }

        /* è¯Šæ–­æ¡† */
        .diagnosis-box {
            background-color: var(--danger-bg);
            border-left: 4px solid var(--danger);
            padding: 1rem;
            border-radius: 0 4px 4px 0;
            margin-top: 1rem;
        }

        .diagnosis-title {
            color: #991b1b;
            font-weight: bold;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        /* è¾“å…¥åŒº */
        textarea {
            width: 100%;
            height: 200px;
            padding: 1rem;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            margin-bottom: 1rem;
            -webkit-appearance: none;
        }

        textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* æŒ‰é’® */
        .btn {
            display: block;
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }

        .btn:active {
            opacity: 0.8;
            transform: scale(0.98);
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        /* è¯„ä»·æŒ‰é’®ç»„ */
        .evaluation-group {
            display: flex;
            gap: 10px;
            margin-top: 1.5rem;
        }

        .btn-success {
            background-color: var(--success);
            color: white;
            flex: 1;
        }

        .btn-warning {
            background-color: var(--warning);
            color: white;
            flex: 1;
        }

        .btn-outline {
            background-color: white;
            border: 1px solid var(--gray-200);
            color: var(--gray-700);
            margin-top: 1rem;
        }

        /* å¯¹æ¯”åŒºåŸŸ */
        .review-section {
            display: none;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .comparison-grid {
            display: grid;
            gap: 1rem;
        }

        .answer-box {
            padding: 1rem;
            border-radius: 8px;
            font-size: 0.95rem;
            white-space: pre-line;
        }

        .old-answer {
            background-color: var(--danger-bg);
            border: 1px solid #fecaca;
            color: #7f1d1d;
        }

        .new-answer {
            background-color: #eff6ff;
            border: 1px solid #bfdbfe;
            color: #1e3a8a;
        }

        .std-box {
            background-color: white;
            border: 1px solid var(--success);
            border-radius: 8px;
            overflow: hidden;
            margin-top: 1rem;
        }

        .std-header {
            background-color: var(--success);
            color: white;
            padding: 10px 15px;
            font-weight: bold;
        }

        .std-body {
            padding: 1.25rem;
        }

        .highlight-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .highlight-list li {
            padding-left: 1.5rem;
            position: relative;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: var(--gray-700);
        }

        .highlight-list li::before {
            content: "â€¢";
            color: var(--warning);
            font-weight: bold;
            font-size: 1.5rem;
            position: absolute;
            left: 0;
            top: -5px;
        }

        /* æ¬¢è¿é¡µä¸åŠ è½½é®ç½© */
        #welcome-screen, #completion-screen {
            text-align: center;
            padding: 2rem 1rem;
        }
        
        .welcome-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .hidden {
            display: none !important;
        }

        /* å‘é€é‚®ä»¶æ—¶çš„åŠ è½½åŠ¨ç”» */
        .loading-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            color: white;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 1000;
        }
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #fff;
            border-top: 4px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <header>
        <div class="header-content">
            <h1>âš–ï¸ æ”¿æ²»ç‰¹è®­</h1>
            <div class="progress-container">
                <span id="progress-text">1/--</span>
                <div class="progress-bar-bg">
                    <div id="progress-bar" class="progress-bar-fill"></div>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        
        <!-- æ¬¢è¿é¡µ -->
        <div id="welcome-screen">
            <div class="welcome-icon">ğŸ¯</div>
            <h2 style="margin-bottom: 0.5rem;">é«˜è€ƒæ”¿æ²» Â· å¼±é¡¹å®šå‘è¯Šç–—</h2>
            <p style="color: var(--text-sub); margin-bottom: 2rem;">
                ä¸“ä¸ºæ‰‹æœºä¼˜åŒ–ã€‚<br>
                åŒ…å«æ”¿æ²»(2012-25)çœŸé¢˜ã€‚<br>
                <strong>åšå®Œåè‡ªåŠ¨å‘é€å­¦ä¹ æŠ¥å‘Šã€‚</strong>
            </p>
            <button onclick="startPractice()" class="btn btn-primary">å¼€å§‹ç‰¹è®­</button>
        </div>

        <!-- ç­”é¢˜é¡µ -->
        <div id="practice-screen" class="hidden">
            
            <!-- é¢˜ç›®å¡ç‰‡ -->
            <div class="card">
                <div class="card-header">
                    <span class="tag" id="q-year">å¹´ä»½</span>
                    <span class="score-tag" id="q-score-info">å¾—åˆ†ä¿¡æ¯</span>
                </div>
                <div class="card-body">
                    <h3 class="q-title" id="q-title">é¢˜ç›®</h3>
                    <div class="q-content" id="q-content">å†…å®¹</div>
                    
                    <div class="diagnosis-box" id="diagnosis-container">
                        <div class="diagnosis-title">âš ï¸ ä¸Šæ¬¡çš„è‡´å‘½ä¼¤ / åšé¢˜æç¤º</div>
                        <div style="font-size: 0.9rem;" id="q-diagnosis"></div>
                    </div>
                </div>
            </div>

            <!-- è¾“å…¥åŒº -->
            <div id="input-section" class="card" style="padding: 1rem;">
                <label style="display:block; font-weight:bold; margin-bottom:0.5rem;">ä½ çš„æ–°å›ç­”ï¼š</label>
                <textarea id="user-input" placeholder="è¯·è¾“å…¥ä½ çš„ç­”æ¡ˆ..."></textarea>
                <div style="display: flex; gap: 12px;">
                    <button onclick="markAsSkipped()" class="btn" style="background: white; border: 1px solid #e5e7eb; color: #6b7280; flex: 1;">è·³è¿‡ â†·</button>
                    <button onclick="submitAnswer()" class="btn btn-primary" style="flex: 2;">æäº¤å¹¶å¯¹æ¯” â”</button>
                </div>
            </div>

            <!-- å¤ç›˜åŒº -->
            <div id="review-section" class="review-section">
                
                <div class="comparison-grid">
                    <div id="old-answer-container">
                        <div style="font-weight:bold; color:#991b1b; margin-bottom:5px;">âŒ ä½ çš„æ—§å›ç­”</div>
                        <div class="answer-box old-answer" id="old-answer-display"></div>
                    </div>
                    <div>
                        <div style="font-weight:bold; color:#1e40af; margin-bottom:5px;">âœï¸ ä½ çš„æ–°å›ç­”</div>
                        <div class="answer-box new-answer" id="new-answer-display"></div>
                    </div>
                </div>

                <!-- æ ‡å‡†ç­”æ¡ˆ -->
                <div class="std-box">
                    <div class="std-header">â˜… æ ‡å‡†ç­”æ¡ˆ & é€»è¾‘</div>
                    <div class="std-body">
                        <div style="background:#fef9c3; padding:10px; border-radius:4px; margin-bottom:1rem;">
                            <strong style="color:#854d0e; font-size:0.8rem; display:block; margin-bottom:4px;">é˜…å·äººè§†è§’ / è§£æ</strong>
                            <div id="examiner-notes" style="font-size:0.9rem;"></div>
                        </div>

                        <div style="margin-bottom:1rem;">
                            <strong style="color:#166534; font-size:0.8rem; display:block; margin-bottom:4px;">å‚è€ƒç­”æ¡ˆ</strong>
                            <div id="std-answer-display" style="font-size:0.95rem; color:#1f2937;"></div>
                        </div>

                        <hr style="border:0; border-top:1px solid #e5e7eb; margin:1rem 0;">

                        <div>
                            <strong style="color:#4338ca; font-size:0.8rem; display:block; margin-bottom:4px;">ğŸš€ æåˆ†å…³é”®</strong>
                            <ul id="key-takeaways" class="highlight-list"></ul>
                        </div>
                    </div>
                </div>

                <!-- è¯„ä»·æŒ‰é’®ç»„ (ä¿®æ”¹å¤„ï¼šæ”¶é›†æŒæ¡æƒ…å†µ) -->
                <div class="evaluation-group">
                    <button onclick="handleResult('review')" class="btn btn-warning">âš ï¸ éœ€å¤ä¹ /æ¨¡ç³Š</button>
                    <button onclick="handleResult('mastered')" class="btn btn-success">âœ… å·²æŒæ¡</button>
                </div>
                <button onclick="resetQuestion()" class="btn btn-outline">â†º é‡åšæœ¬é¢˜</button>

            </div>

        </div>

    </div>

    <!-- åŠ è½½ä¸­é®ç½© -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
        <p>æ­£åœ¨ç”Ÿæˆå­¦ä¹ æŠ¥å‘Šå¹¶å‘é€é‚®ä»¶...</p>
        <p style="font-size: 0.8rem; opacity: 0.8;">è¯·å‹¿å…³é—­é¡µé¢</p>
    </div>

    <script>
        // --- 1. é…ç½®ä¸åˆå§‹åŒ– ---
        const EMAIL_CONFIG = {
            serviceID: "service_j2ak28v",
            templateID: "template_ol3ws9o",
            publicKey: "bGbqCw1wlTrkCwfFo"
        };

        (function() {
            emailjs.init(EMAIL_CONFIG.publicKey);
        })();

        // --- 2. çŠ¶æ€ç®¡ç† ---
        let currentIndex = 0;
        let sessionLogs = []; // ç”¨äºå­˜å‚¨æœ¬æ¬¡åšé¢˜è®°å½•ï¼š{title, result, answer}

        // é¢˜ç›®æ•°æ®
        const questions = [
            // --- æ”¿æ²»éƒ¨åˆ† (2025 é”™é¢˜) ---
            {
                id: 8,
                subject: "politics",
                year: "2025 é«˜è€ƒæ”¿æ²»",
                title: "ç¬¬16é¢˜ï¼šæ³•æ²»ä¸ç§‘æŠ€çš„â€œåŒå‘å¥”èµ´â€",
                content: `<strong>èƒŒæ™¯ï¼š</strong>æŸå¸‚å½¢æˆâ€œé¢†å†›è€…+å°å¾®â€æ ¼å±€ï¼Œç¡¬æ ¸ç§‘æŠ€æˆä¸ºåç‰‡ã€‚<br>
                          <strong>é—®é¢˜ï¼š</strong>ç»“åˆææ–™ï¼Œè¿ç”¨ã€Šæ”¿æ²»ä¸æ³•æ²»ã€‹çŸ¥è¯†ï¼Œè¯´æ˜è¯¥å¸‚ç§‘æŠ€åˆ›æ–°ç”Ÿæ€çš„ä¼˜åŒ–å¾—ç›Šäºæ³•æ²»ä¸ç§‘æŠ€çš„â€œåŒå‘å¥”èµ´â€ã€‚`,
                oldAnswer: `åšæŒç§‘å­¦ç«‹æ³•,æ”¿åºœè¦ä¸æ–­å®Œç´ æ³•æ²»ä½“ç³»... åšæŒä¸¥æ ¼å¿…æ³•,æ‰“æ³•ä¾µæƒè¡Œä¸º... åšæŒç§‘æŠ€èµ‹èƒ½...`,
                scoreInfo: "æ—§å¾—åˆ†ï¼šä¸»ä½“é”™è¯¯ / æ¼ç‚¹",
                diagnosis: `1. <strong>ä¸»ä½“é”™è¯¯ï¼š</strong> â€œæ”¿åºœç«‹æ³•â€ä¸¥é‡é”™è¯¯ï¼ç«‹æ³•æ˜¯äººå¤§çš„èŒæƒï¼Œæ”¿åºœæ˜¯åˆ¶å®šè¡Œæ”¿æ³•è§„ã€‚<br>
                            2. <strong>æ¼ç‚¹ï¼š</strong> æ”¿æ²»é¢˜é¦–é€‰å¿…ç­”<strong style="color:red">â€œå…šçš„é¢†å¯¼â€</strong>ã€‚<br>
                            3. <strong>ç»“åˆä¸å¤Ÿï¼š</strong> æœªå…·ä½“å±•å¼€æ³•æ²»å¦‚ä½•ä¿æŠ¤ç§‘æŠ€ï¼ˆå¦‚çŸ¥è¯†äº§æƒï¼‰ã€‚`,
                examinerNotes: [
                    "æ”¿æ²»é¢˜â€œèµ·æ‰‹å¼â€ï¼šå…šçš„é¢†å¯¼æ˜¯æ ¹æœ¬ä¿è¯ã€‚",
                    "ç§‘å­¦ç«‹æ³•ï¼ˆäººå¤§/å®Œå–„ä½“ç³»ï¼‰+ ä¸¥æ ¼æ‰§æ³•/å…¬æ­£å¸æ³•ï¼ˆçŸ¥è¯†äº§æƒä¿æŠ¤ï¼‰ã€‚",
                    "å…¨æ°‘å®ˆæ³•ï¼ˆè¥é€ æ°›å›´ï¼‰+ ç§‘æŠ€èµ‹èƒ½ï¼ˆæé«˜æ³•æ²»æ•ˆèƒ½ï¼‰ã€‚"
                ],
                stdAnswer: `â‘  <strong>å…šçš„é¢†å¯¼ï¼š</strong> æä¾›æ”¿æ²»ä¿è¯ã€‚<br>
                            â‘¡ <strong>ç§‘å­¦ç«‹æ³•ï¼š</strong> å®Œå–„ç§‘æŠ€æ³•è§„ï¼Œæä¾›åˆ¶åº¦ä¾›ç»™ã€‚<br>
                            â‘¢ <strong>ä¸¥æ ¼æ‰§æ³•/å…¬æ­£å¸æ³•ï¼š</strong> ä¿æŠ¤çŸ¥è¯†äº§æƒï¼Œç»´æŠ¤å¸‚åœºç§©åºã€‚<br>
                            â‘£ <strong>å…¨æ°‘å®ˆæ³•ï¼š</strong> è¥é€ å°Šé‡åˆ›æ–°çš„æ°›å›´ã€‚<br>
                            â‘¤ <strong>ç§‘æŠ€èµ‹èƒ½ï¼š</strong> åˆ©ç”¨å¤§æ•°æ®æå‡æ³•æ²»æ•ˆèƒ½ã€‚`,
                takeaways: [
                    "æ”¿æ²»ä¸æ³•æ²»å¤§é¢˜ç»“æ„ï¼šå…š + ç«‹æ³• + æ‰§æ³•/å¸æ³• + å®ˆæ³• + ææ–™ç‰¹è‰²ï¼ˆç§‘æŠ€èµ‹èƒ½ï¼‰ã€‚"
                ]
            },
            {
                id: 9,
                subject: "politics",
                year: "2025 é«˜è€ƒæ”¿æ²»",
                title: "ç¬¬17é¢˜ï¼šé—äº§ä¿æŠ¤ä¸­çš„â€œå®äº‹æ±‚æ˜¯â€",
                content: `<strong>èƒŒæ™¯ï¼š</strong>å¼€å°å®‹éŸµã€è‹å·ä¸€å®…ä¸€æ–¹æ¡ˆã€å±å—è€å±‹è®¤ç§Ÿã€‚<br>
                          <strong>é—®é¢˜ï¼š</strong>è¿ç”¨ã€Šå“²å­¦ä¸æ–‡åŒ–ã€‹çŸ¥è¯†ï¼Œåˆ†æåœ¨å†å²æ–‡åŒ–é—äº§ä¿æŠ¤ä¼ æ‰¿ä¸­å¦‚ä½•ä»å®é™…å‡ºå‘ã€å®äº‹æ±‚æ˜¯ã€‚`,
                oldAnswer: `æŠŠä¸»è§‚èƒ½åŠ¨æ€§å’Œå°Šé‡å®¢è§‚è§„å¾‹ç»“åˆèµ·æ¥... å‘æŒ¥äººçš„ä¸»è§‚èƒ½åŠ¨æ€§... å°Šé‡ç‰©è´¨è¿åŠ¨çš„å®¢è§‚è§„å¾‹...`,
                scoreInfo: "æ—§å¾—åˆ†ï¼šåŸç†å¯¹ä½†æ— ç»“åˆ",
                diagnosis: `1. <strong>ç©ºæ´ï¼š</strong> å“²å­¦é¢˜å¿…é¡»æ˜¯â€œåŸç† + æ–¹æ³•è®º + <strong style="color:red">ææ–™åˆ†æ</strong>â€ã€‚ä½ åªèƒŒäº†åŸç†ã€‚<br>
                            2. <strong>æ¼ç‚¹ï¼š</strong> å®äº‹æ±‚æ˜¯çš„å‰ææ˜¯â€œè°ƒæŸ¥ç ”ç©¶â€ï¼ˆäº†è§£å¤åŸå®é™…ï¼‰ã€‚`,
                examinerNotes: [
                    "å°Šé‡å®¢è§‚è§„å¾‹ï¼šç«‹è¶³å¤åŸå®é™…ã€‚",
                    "å‘æŒ¥ä¸»è§‚èƒ½åŠ¨æ€§ï¼šè§£æ”¾æ€æƒ³ï¼Œæ¢ç´¢æ–°æ¨¡å¼ï¼ˆå¦‚è®¤ç§Ÿï¼‰ã€‚",
                    "äºŒè€…ç»“åˆï¼šæ—¢ä¿æŠ¤æ–‡ç‰©åˆå‘å±•æ°‘ç”Ÿï¼ˆå…·ä½“çš„å†å²çš„ç»Ÿä¸€ï¼‰ã€‚"
                ],
                stdAnswer: `â‘  <strong>å°Šé‡å®¢è§‚è§„å¾‹ï¼š</strong> ç«‹è¶³æœ¬åœ°å¤åŸã€è€å®…å®é™…ï¼Œæ¢å¯»ä¿æŠ¤è§„å¾‹ã€‚<br>
                            â‘¡ <strong>å‘æŒ¥ä¸»è§‚èƒ½åŠ¨æ€§ï¼š</strong> è§£æ”¾æ€æƒ³ï¼Œæ¢ç´¢â€œè®¤ç§Ÿâ€ç­‰æ–°æ¨¡å¼ã€‚<br>
                            â‘¢ <strong>äºŒè€…ç»“åˆï¼š</strong> å°†ä¿æŠ¤ä¸æ°‘ç”Ÿ/äº§ä¸šç»“åˆï¼Œåšåˆ°ä¸»è§‚ä¸å®¢è§‚å…·ä½“çš„å†å²çš„ç»Ÿä¸€ã€‚`,
                takeaways: [
                    "å“²å­¦é¢˜å…¬å¼ï¼šåŸç† + æ–¹æ³•è®º + ææ–™ï¼ˆæŠ„ææ–™é‡Œçš„åšæ³•ä½œä¸ºè®ºæ®ï¼‰ã€‚"
                ]
            },
            {
                id: 10,
                subject: "politics",
                year: "2025 é«˜è€ƒæ”¿æ²»",
                title: "ç¬¬18é¢˜ï¼šåŠ³åŠ¨æƒç›Šä¸ä¼ä¸šè´Ÿæ‹…",
                content: `<strong>(1) ã€Šæ³•å¾‹ä¸ç”Ÿæ´»ã€‹ï¼š</strong>åˆ†æâ€œä¸¤å¹´ä¸å‡†ç»“å©šâ€åˆåŒçš„ä¸å½“ä¹‹å¤„åŠç»´æƒé€”å¾„ã€‚<br>
                          <strong>(2) ã€Šç»æµä¸ç¤¾ä¼šã€‹ï¼š</strong>è¯„æâ€œç»™éª‘æ‰‹äº¤ç¤¾ä¿åŠ é‡ä¼ä¸šè´Ÿæ‹…ï¼Œä¸åˆ©äºå‘å±•â€çš„è§‚ç‚¹ã€‚`,
                oldAnswer: `(1) ä¾µçŠ¯ä¼‘æ¯æƒ... æ‰¾ç¬¬ä¸‰æ–¹è°ƒè§£æˆ–ç›´æ¥ä»²è£/è¯‰è®¼ã€‚\n(2) æé«˜æ”¶å…¥æ˜¯æ¶ˆè´¹åŸºç¡€... æé«˜å·¥ä½œç§¯ææ€§...`,
                scoreInfo: "æ—§å¾—åˆ†ï¼šç¨‹åºé”™è¯¯ / å•å‘æ€ç»´",
                diagnosis: `1. <strong>ç¨‹åºé”™è¯¯ï¼š</strong> åŠ³åŠ¨çº çº·å¿…é¡»<strong style="color:red">å…ˆä»²è£</strong>ï¼Œä¸æœæ‰èƒ½è¯‰è®¼ï¼ˆä»²è£å‰ç½®ï¼‰ã€‚<br>
                            2. <strong>æ¼æƒç›Šï¼š</strong> æ¼äº†â€œå©šå§»è‡ªç”±æƒâ€ã€â€œå¹³ç­‰å°±ä¸šæƒâ€ã€‚<br>
                            3. <strong>è¯„æé¢˜ï¼š</strong> ä¸èƒ½åªè¯´å¥½å¤„ï¼Œè¦å…ˆæ‰¿è®¤â€œçŸ­æœŸç¡®å®åŠ é‡è´Ÿæ‹…ï¼ˆåˆç†æ€§ï¼‰â€ï¼Œå†é©³æ–¥â€œé•¿æœŸæœ‰åˆ©ï¼ˆä¸åˆç†æ€§ï¼‰â€ã€‚`,
                examinerNotes: [
                    "ç»´æƒï¼šæŠ•è¯‰ -> ä»²è£ï¼ˆå¿…ç»ï¼‰ -> è¯‰è®¼ã€‚",
                    "è¯„æï¼šçŸ­æœŸå¢åŠ æˆæœ¬ï¼ˆåˆç†ï¼‰ï¼›é•¿æœŸå¢å¼ºå‡èšåŠ›/æ‹‰åŠ¨æ¶ˆè´¹ï¼ˆä¸åˆç†ï¼‰ã€‚"
                ],
                stdAnswer: `<strong>(1) ä¸å½“ï¼š</strong> ä¾µçŠ¯å©šå§»è‡ªç”±ï¼ˆæ— æ•ˆæ¡æ¬¾ï¼‰ï¼›ä¾µçŠ¯ä¼‘æ¯æƒï¼›è¿æ³•è§£é™¤åˆåŒï¼ˆä¾µçŠ¯å¹³ç­‰å°±ä¸šæƒï¼‰ã€‚<br>
                            <strong>ç»´æƒï¼š</strong> æŠ•è¯‰ã€ç”³è¯·ä»²è£ï¼ˆå¿…ç»ï¼‰ã€èµ·è¯‰ã€‚<br><br>
                            <strong>(2) è¯„æï¼š</strong> ç‰‡é¢ã€‚<br>
                            åˆç†æ€§ï¼šçŸ­æœŸç¡®å®å¢åŠ æˆæœ¬ã€‚<br>
                            é©³æ–¥ï¼šå¾®è§‚åˆ©äºç•™ä½äººæ‰/æ ‘ç«‹å½¢è±¡ï¼›å®è§‚åˆ©äºå…±åŒå¯Œè£•/æ‹‰åŠ¨æ¶ˆè´¹ã€‚<br>
                            ç»“è®ºï¼šä¼ä¸šåº”æ‰¿æ‹…ç¤¾ä¼šè´£ä»»ã€‚`,
                takeaways: [
                    "åŠ³åŠ¨ä»²è£æ˜¯è¯‰è®¼çš„å‰ç½®ç¨‹åºï¼Œä¸å¯ç›´æ¥èµ·è¯‰ã€‚",
                    "è¯„æé¢˜é€»è¾‘ï¼šè‚¯å®šåˆç†ç‚¹ + å¦å®šä¸åˆç†ç‚¹ + æ€»ç»“æ­£ç¡®æ€åº¦ã€‚"
                ]
            },
            {
                id: 11,
                subject: "politics",
                year: "2025 é«˜è€ƒæ”¿æ²»",
                title: "ç¬¬19é¢˜ï¼šå‘¨è¾¹å¤–äº¤ä¸è¶…å‰æ€ç»´",
                content: `<strong>(1) ã€Šå½“ä»£å›½é™…æ”¿æ²»ä¸ç»æµã€‹ï¼š</strong>é˜æ˜æ„å»ºå‘¨è¾¹å‘½è¿å…±åŒä½“çš„åŸå› ã€‚<br>
                          <strong>(2) ã€Šé€»è¾‘ä¸æ€ç»´ã€‹ï¼š</strong>é€‰é¢†åŸŸæç»˜10å¹´åæˆå°±ï¼Œå¹¶è¯´æ˜æ„æƒ³æ–¹æ³•ã€‚`,
                oldAnswer: `(1) å’Œå¹³å…±å¤„äº”é¡¹åŸåˆ™... æ—¶ä»£ä¸»é¢˜... å…±åŒåˆ©ç›Š...`,
                scoreInfo: "æ—§å¾—åˆ†ï¼š(1)ä¼˜ (2)æ¼æ–¹æ³•",
                diagnosis: `1. <strong>ç¬¬ä¸€é—®å¾ˆå¥½ï¼š</strong> è¸©ä¸­äº†å›½å®¶åˆ©ç›Šã€æ—¶ä»£ä¸»é¢˜ã€å¤–äº¤æ”¿ç­–ã€‚<br>
                            2. <strong>ç¬¬äºŒé—®æ¼ç‚¹ï¼š</strong> é¢˜ç›®é—®â€œæ„æƒ³æ–¹æ³•â€ï¼Œä¸æ˜¯è®©ä½ å†™ä½œæ–‡ã€‚è¦ç­”<strong style="color:red">â€œçŸ›ç›¾åˆ†æâ€ã€â€œæ¨ç†â€ã€â€œæƒ³è±¡â€</strong>ç­‰æ€ç»´æ–¹æ³•ã€‚`,
                examinerNotes: [
                    "è¶…å‰æ€ç»´é¢˜é‡ç‚¹åœ¨â€œæ–¹æ³•è®ºâ€ã€‚",
                    "æ€ä¹ˆæ¨å¯¼å‡ºæ¥çš„ï¼Ÿç”¨äº†çŸ›ç›¾åˆ†æã€å› æœæ¨ç†ã€åˆ›æ–°æ€ç»´ã€‚"
                ],
                stdAnswer: `<strong>(1) åŸå› ï¼š</strong> å›½å®¶åˆ©ç›Šï¼ˆå…±åŒåˆ©ç›Šï¼‰ï¼›æ—¶ä»£ä¸»é¢˜ï¼ˆå’Œå¹³å‘å±•ï¼‰ï¼›å¤–äº¤æ”¿ç­–ï¼ˆäº²è¯šæƒ å®¹ï¼‰ï¼›å¤šæåŒ–è¶‹åŠ¿ã€‚<br><br>
                            <strong>(2) æ–¹æ³•ï¼š</strong> <br>
                            â‘  <strong>çŸ›ç›¾åˆ†ææ³•ï¼š</strong> åˆ†æç°çŠ¶ä¸ç›®æ ‡çš„çŸ›ç›¾ã€‚<br>
                            â‘¡ <strong>æ¨ç†æ€§ï¼š</strong> æ ¹æ®ç°æœ‰æ”¿ç­–æ¨æ–­æœªæ¥è¶‹åŠ¿ã€‚<br>
                            â‘¢ <strong>åˆ›æ–°æ€ç»´ï¼š</strong> åˆç†è”æƒ³å»ºæ„æœªæ¥åœºæ™¯ã€‚`,
                takeaways: [
                    "é€»è¾‘ä¸æ€ç»´æ–°é¢˜å‹ï¼šé—®â€œæ–¹æ³•â€æ—¶ï¼Œå¿…é¡»åˆ—ä¸¾æ€ç»´å·¥å…·ï¼ˆæ¨ç†ã€æƒ³è±¡ã€çŸ›ç›¾åˆ†æï¼‰ã€‚"
                ]
            }
        ];

        // --- 3. æ ¸å¿ƒé€»è¾‘å‡½æ•° ---

        function startPractice() {
            document.getElementById('welcome-screen').classList.add('hidden');
            document.getElementById('practice-screen').classList.remove('hidden');
            document.getElementById('practice-screen').style.animation = 'fadeIn 0.5s';
            sessionLogs = []; // é‡ç½®æ—¥å¿—
            updateTotalCount();
            loadQuestion(0);
        }

        function updateTotalCount() {
            document.getElementById('progress-text').innerText = `1/${questions.length}`;
        }

        function loadQuestion(index) {
            currentIndex = index;
            const q = questions[index];

            // è¿›åº¦æ›´æ–°
            document.getElementById('progress-text').innerText = `${index + 1}/${questions.length}`;
            document.getElementById('progress-bar').style.width = `${((index + 1) / questions.length) * 100}%`;

            // æ¸²æŸ“ Header
            const yearTag = document.getElementById('q-year');
            yearTag.innerText = q.year;
            if (q.subject === 'politics') {
                yearTag.classList.add('tag-pol');
            } else {
                yearTag.classList.remove('tag-pol');
            }

            document.getElementById('q-score-info').innerText = q.scoreInfo;
            document.getElementById('q-title').innerText = q.title;
            document.getElementById('q-content').innerHTML = q.content;
            
            // æ¸²æŸ“è¯Šæ–­ä¿¡æ¯
            document.getElementById('q-diagnosis').innerHTML = q.diagnosis;

            // é‡ç½®è¾“å…¥åŒº
            document.getElementById('user-input').value = '';
            document.getElementById('input-section').style.display = 'block';
            document.getElementById('review-section').style.display = 'none';

            // å¤„ç†æ—§å›ç­”æ˜¾ç¤º
            if (q.scoreInfo === "ç»å…¸çœŸé¢˜ç»ƒä¹ ") {
                document.getElementById('old-answer-container').style.display = 'none';
            } else {
                document.getElementById('old-answer-container').style.display = 'block';
                document.getElementById('old-answer-display').innerText = q.oldAnswer;
            }
            
            document.getElementById('std-answer-display').innerHTML = q.stdAnswer;
            
            // æ¸²æŸ“åˆ—è¡¨
            document.getElementById('examiner-notes').innerHTML = q.examinerNotes.map(n => `<div>â€¢ ${n}</div>`).join('');
            document.getElementById('key-takeaways').innerHTML = q.takeaways.map(t => `<li>${t}</li>`).join('');

            window.scrollTo(0, 0);
        }

        function submitAnswer() {
            const val = document.getElementById('user-input').value;
            if (!val.trim()) {
                alert("è¯·å…ˆè¾“å…¥ä¸€äº›å…³é”®è¯ï¼Œæˆ–è€…é€‰æ‹©â€˜è·³è¿‡â€™");
                return;
            }

            document.getElementById('new-answer-display').innerText = val;
            document.getElementById('input-section').style.display = 'none';
            document.getElementById('review-section').style.display = 'block';
            
            // æ»šåŠ¨åˆ°å¯¹æ¯”åŒº
            document.getElementById('review-section').scrollIntoView({ behavior: 'smooth' });
        }

        // æ ‡è®°ä¸ºè·³è¿‡
        function markAsSkipped() {
            recordAndNext("å·²è·³è¿‡", "æ— å›ç­”");
        }

        // å¤„ç†å¤ç›˜ç»“æœï¼ˆæŒæ¡æˆ–éœ€å¤ä¹ ï¼‰
        function handleResult(status) {
            const currentQ = questions[currentIndex];
            const userAns = document.getElementById('user-input').value;
            
            let statusText = "";
            if(status === 'mastered') statusText = "âœ… å·²æŒæ¡";
            if(status === 'review') statusText = "âš ï¸ éœ€å¤ä¹ ";

            recordAndNext(statusText, userAns);
        }

        // è®°å½•æ•°æ®å¹¶å†³å®šä¸‹ä¸€æ­¥
        function recordAndNext(statusText, userAnswer) {
            const currentQ = questions[currentIndex];
            
            // 1. è®°å½•æ—¥å¿—
            sessionLogs.push({
                title: currentQ.title,
                year: currentQ.year,
                status: statusText,
                userAnswer: userAnswer.substring(0, 100) + (userAnswer.length > 100 ? "..." : "") // æˆªæ–­è¿‡é•¿æ–‡æœ¬
            });

            // 2. åˆ¤æ–­æ˜¯å¦ç»“æŸ
            if (currentIndex < questions.length - 1) {
                loadQuestion(currentIndex + 1);
            } else {
                sendEmailReport();
            }
        }

        function resetQuestion() {
            document.getElementById('review-section').style.display = 'none';
            document.getElementById('input-section').style.display = 'block';
            document.getElementById('input-section').style.animation = 'fadeIn 0.3s';
            document.getElementById('user-input').focus();
        }

        // --- 4. é‚®ä»¶å‘é€é€»è¾‘ ---
        function sendEmailReport() {
            // æ˜¾ç¤ºåŠ è½½é®ç½©
            document.getElementById('loading-overlay').style.display = 'flex';

            // æ ¼å¼åŒ–é‚®ä»¶å†…å®¹
            let emailBody = "ã€é«˜è€ƒæ”¿æ²»ç‰¹è®­æŠ¥å‘Šã€‘\n\n";
            emailBody += `å®Œæˆæ—¶é—´: ${new Date().toLocaleString()}\n`;
            emailBody += `å…±å®Œæˆé¢˜ç›®: ${sessionLogs.length} é“\n\n`;
            emailBody += "----------------------------------------\n";

            sessionLogs.forEach((log, index) => {
                emailBody += `é¢˜ ${index + 1}: ${log.title} (${log.year})\n`;
                emailBody += `æŒæ¡æƒ…å†µ: ${log.status}\n`;
                emailBody += `æˆ‘çš„å›ç­”: ${log.userAnswer}\n`;
                emailBody += "----------------------------------------\n";
            });

            const templateParams = {
                message: emailBody,
                // è¿™é‡Œå‡è®¾æ¨¡æ¿é‡Œæœ‰ä¸ª {{message}} å˜é‡
            };

            emailjs.send(EMAIL_CONFIG.serviceID, EMAIL_CONFIG.templateID, templateParams)
                .then(function(response) {
                    document.getElementById('loading-overlay').style.display = 'none';
                    alert(`ğŸ‰ ç‰¹è®­å®Œæˆï¼\né‚®ä»¶å‘é€æˆåŠŸ (Status: ${response.status})\nå¥½å¥½ä¼‘æ¯ï¼`);
                    // å¯ä»¥åœ¨è¿™é‡Œé‡å®šå‘æˆ–è€…æ˜¾ç¤ºå®Œæˆé¡µ
                    location.reload(); // ç®€å•é‡ç½®
                }, function(error) {
                    document.getElementById('loading-overlay').style.display = 'none';
                    alert('ç‰¹è®­å®Œæˆï¼Œä½†é‚®ä»¶å‘é€å¤±è´¥ã€‚\né”™è¯¯ä¿¡æ¯: ' + JSON.stringify(error));
                    console.log("Email Failed:", error);
                });
        }
    </script>
</body>
</html>
